var newData=function(){for(var e=400,r=[],a=["Buffy","Willow","Xander","Giles","Angel","Spike","Cordelia","Oz","Tara","Dawn","Anya","Joyce","Jonathan","Glory","Malcolm","Kaylee","Zoe","Wash","Jayne","Inara","Simon","River","Shepherd","Paul","John","Ringo","George","Lorelai","Rory","Jess","Dean","Luke","Max","Paris","Sookie","Ms. Patty","Lane","Michel","Kirk","Digger","Taylor","Marty","Logan","Christopher","Emily","Richard","Maxmilian","Benji","Jon","Keith","Milena","Andre","Little Max","Talia","Eric","Melissa","Eloise","Mark","Tom","Travis","Dan","Phil","Julian","Nikolai","Fabrizio","Nick","Albert","James Tiberius","Spock","McCoy","Uhura","Scotty","Sulu","Chekov","Bartlet","Leo","Josh","Toby","Donna","Charlie","CJ","Mandy","Amy","JD","Turk","Elliot","Carla","Kelso","Perry","Janitor","Laverne","Rose","Mickey","Jack","Donna","Martha","River Song","Amy ","Rory","Clara Oswin","The Doctor","Ten","Eleven","Twelve","Thirteen","Frodo","Sam","Merry","Pippin","Aragorn","Boromir","Faramir","Legolas","Eowyn","Arwen","Gimli","Gandalf","Elrond","Galadriel","Bombadil","Saruman","Bilbo","Fëanor","Lúthien","Eru","Ilúvatar","Fingolfin","Beren","Luthien","Thingol","Elendil","Elwing","Isildur","Glorfindel","Sauran","Harry ","Ron","Hermione","Neville","Drako","Volde","Rachel","Bucky","Elizabeth","McKibben","Lanier","Rushkoff","Walden","Mars","Jupiter","Pluto","Neptune","Uranus","Mercury","Saturn","Venus","Galifrey","Moon Moon","Idgy Dean","Debbie","Black","Biersack","Tommy","Joey","Dee Dee","Marky","Johnny","Richie","Clem","Jack","Meg","Mercer","Brian","Brandon","Win","Will","Billy","Regine","Pink","Ariel","Mayberry","Clif","Colin","Bowie","Donnie","Zach","Elton","Marshall","Stevie","Fleetwood","Monty","Zilla","Zubin","Muska","Lee","Wolfgang","Lesley","Jesusita","Layne","Efren","Daron","Jennell","Sheridan","Letisha","Demetria","Etha","Eva","Hee","Annett","Janella","Tynisha","Cathrine","Terisa","Jesusa","Jeane","Yvone","Carmelina","Isaias","Gertude","April","Lisabeth","Sook","Kayce","Edythe","Otto","Lelah","Latrina","Klara","Anderson","Signe","Kathrin","Leoma","Raul","Katherina","Andree","Nelida","Maryann","Kamilah","Celine","Cathern","Nohemi","Ethelyn","Manie","Donovan","Elayne","Kathlyn","Laima","Elena","Linnea","Kanisha","Vita","Ruthann","Thaddeus","Joanna","Glennis","Zena","Dagny","Rosita","Jadwiga","Debi","Terence","Willy","Kymberly","Jacinto","Raelene","Renata","Rebekah","Myrtice","Delmer","Lakenya","Martina","Leighann","Elinor","Nan","Anastasia","Kiley","Akilah","Hugh","Lincoln","Jestine","Cristopher","Darrell","Vicenta","Dustin","Candra","Shea","Agatha","Cordia","Henriette","Jade","Alberto","Dotty","Effie","Macie","Timmy","Roxanna","Karl","Chana","Mana","Bette","Hosea","Ona","Kitty","Marnie","Abby","Greg","Senaida","Matha","Laree","Desiree","Roderick","Loyce","Rossie","Thersa","Karoline","Annie","Socorro","Weldon","Antoinette","Freeman","Harvey","Pamula","Pura","Lucrecia","Corina","Jaye","Lashay","Kyle","Alyssa","Dawn","Dedra","Syble","Ashlyn","Sarah","Judy","Pok","Geth","Ismael","Vern","Werner","Elvira","Charline","Jarvis","Becky","Carlo","Hiedi","Vance","Juliette","Marylin","Rosena","Tinisha","Camilla","Aiko","Jacquie","Jone","Roonie","Leatrice","Emilie","Spring","Teodoro","Tai","Normand","Cristin","Euna","Lester","Ashanti","Booker","Margo","Lyman","Yetta","Audrey","Kellee","Daria","Pennie","Bryanna","Lulu","Marcelo","Kelley","Gerda","Ricky","Nenita","Kathlene","Geoffrey","Laureen","Kit","Maxie","Hollis","Weston","Janey","Randy","Pat","Lisha","Ginette","Dane","Temple","Hermina","Sherill","Chris","Shannon","Bluvband"],t=0;e>t;t++){var n=Object.create(deeb);n.init(random(-100,w,!1),random(100,h,!1),t,a[t]),r.push(n)}var o=new Date,i={};i.points=100,i.deebsAlive=400,i.deebsDead=0,i.visitors=0,i.lastArchive=0,i.lastVisit=o.getDate()+"/"+(o.getMonth()+1)+"/"+o.getFullYear();var s={};s.info=i,s.critters=r;var l=JSON.stringify(s);$.ajax({dataType:"json",url:"save.php",type:"POST",success:function(e){console.log(e)},data:{json:l}})},readJSON=function(){var e=new XMLHttpRequest;e.open("GET","assets/creatures.json"),e.onreadystatechange=function(){if(4==e.readyState){var r=JSON.parse(e.responseText);myDeebs=r.critters,systemInfo=r.info;var a=new Date,t=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear(),n=systemInfo.lastVisit,o=daysEllapsed(parseDate(t),parseDate(n));if(console.log(systemInfo.lastArchive),systemInfo.lastArchive+=o+1,points=systemInfo.points,points<0?points=0:points>400&&(points=400),0==runCount){var i=Math.floor(systemInfo.lastArchive/10);makeArchive(i,systemInfo.points),runCount++}canvas.width=window.innerWidth,canvas.height=window.innerHeight,w=window.innerWidth,h=window.innerHeight,systemInfo.visitors+=1,systemInfo.points+=2*o,dFills=getDeebFills(systemInfo.points),dStroke=getDeebStroke(systemInfo.points),ddFills=getDeadDeebFills(),ddStroke="hsla(180,10%,80%,0.2)",bgPattern=backgroundPattern(systemInfo.points),systemInfo.points<=0&&(systemInfo.points=0),createObjectArray(systemInfo.points,myDeebs),systemInfo.lastVisit=t,systemInfo.deebsDead=deadCount}},e.send()};readJSON();var l=0,makeArchive=function(e,r){if(canvas.width=800,canvas.height=800,w=800,h=800,e>l){console.log("archiving",l,"of",e),r-=20,dFills=getDeebFills(r),dStroke=getDeebStroke(r),ddFills=getDeadDeebFills(),ddStroke="hsla(180,10%,80%,0.2)",bgPattern=backgroundPattern(r),createObjectArray(r,myDeebs),drawCanvas();var a=canvas.toDataURL(),t=new Image;t.onload=function(){myImages.push(t.src),myImages.length>=e&&saveImages(myImages)},t.src=a,jsonObjects=[],deebs=[],critterArray=[],l++,systemInfo.lastArchive-=10,systemInfo.lastArchive<=0&&(systemInfo.lastArchive=0),makeArchive(e,r)}},saveImages=function(e){for(var r="",a=0;a<e.length;a++)r+=e[a]+"> ";$.ajax({dataType:"text",url:"saveImages.php",type:"POST",success:function(e){console.log(e)},data:{urls:r}}).done(function(){console.log("archived")})},deadCount,createObjectArray=function(e,r){var a=Math.round(w*h/22500),t=Math.round(.2*a),n=Math.round(a),o=Math.round(a*map(e,400,0,.3,1.5)),i=Math.round(.8*o),s=Math.round(a*map(e,400,0,.2,.6)),l=Math.round(a*map(e,400,0,.2,.6));e>400&&(t=Math.round(.2*a),n=Math.round(.8*a),o=Math.round(a*map(e,400,800,.3,.05)),i=Math.round(.8*o),s=Math.round(a*map(e,400,800,.2,.05))),deadCount=0;for(var y=0;y<r.length;y++){var c=Object.create(deeb);c.setup(random(0,w,!1),random(100,h,!1),r[y].name,r[y].points,r[y].bodyWidth,r[y].bodyHeight,r[y].state,r[y].speed,r[y].index),0==c.state&&deadCount++,jsonObjects.push(c)}for(var d=0;l>d;d++){var u=random(0,jsonObjects.length-1);critterArray.push(jsonObjects[u])}for(var m=0;s>m;m++)tempBush=Object.create(bush),tempBush.setup(random(0,w,!1),random(0,h,!1)),critterArray.push(tempBush);for(var v=0;o>v;v++){var A=Object.create(flower);A.setup(random(0,w,!1),random(0,h,!1)),critterArray.push(A)}for(var e=0;i>e;e++){var g=Object.create(plant);g.setup(random(0,w,!1),random(0,h,!1)),critterArray.push(g)}for(var f=0;t>f;f++){var p=Object.create(rock);p.setup(random(0,w,!1),random(0,h,!1)),critterArray.push(p)}for(var b=0;n>b;b++){var M=Object.create(grass);M.setup(random(0,w,!1),random(0,h,!1)),critterArray.push(M)}};window.onresize=function(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,w=window.innerWidth,h=window.innerHeight,jsonObjects=[],deebs=[],critterArray=[],readJSON()};var hoverCount=0,drawCanvas=function(){fill(bgPattern),fRect(0,0,w,h),critterArray.sort(function(e,r){return e.yPos-r.yPos});for(var e=0;e<critterArray.length;e++)"deeb"==critterArray[e].type?mouseX>critterArray[e].xPos-critterArray[e].bodyWidth/2&&mouseX<critterArray[e].xPos+critterArray[e].bodyWidth/2&&mouseY<critterArray[e].yPos&&mouseY>critterArray[e].yPos-critterArray[e].bodyHeight&&1>hoverCount?(critterArray[e].hover=!0,hoverCount++):(hoverCount=0,critterArray[e].hover=!1):"flower"==critterArray[e].type?mouseX>critterArray[e].xPos-15&&mouseX<critterArray[e].xPos+15&&mouseY<critterArray[e].yPos&&mouseY>critterArray[e].yPos-30&&1>hoverCount?(critterArray[e].hover=!0,hoverCount++):(hoverCount=0,critterArray[e].hover=!1):"rock"==critterArray[e].type&&(mouseX>critterArray[e].xPos-critterArray[e].width/2&&mouseX<critterArray[e].xPos+critterArray[e].width/2&&mouseY<critterArray[e].yPos&&mouseY>critterArray[e].yPos-critterArray[e].height&&1>hoverCount?(critterArray[e].hover=!0,hoverCount++):(hoverCount=0,critterArray[e].hover=!1)),critterArray[e].update()};setInterval(function(){drawCanvas()},33),window.onbeforeunload=function(){};